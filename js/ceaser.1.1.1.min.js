// Ceaser by Matthew Lein
// matthewlein.com/ceaser/
// human-readable source at matthewlein.com/ceaser/js/ceaser.1.1.1.js

$("h1 span").css("display","inline-block");var canvas=document.getElementById("curve"),ctx=canvas.getContext("2d"),box=document.getElementById("box"),code=document.getElementById("codeOutput"),supportTouches=("createTouch" in document),time=document.getElementById("time"),timeVal=500;function BezierHandle(a,b){this.x=a;this.y=b;this.width=10;this.height=10;}BezierHandle.prototype.getSides=function(){this.left=this.x-(this.width/2);this.right=this.left+this.width;this.top=this.y-(this.height/2);this.bottom=this.top+this.height;};BezierHandle.prototype.draw=function(){this.getSides();ctx.fillStyle="#222";ctx.fillRect(this.left,this.top,this.width,this.height);};var handles=[new BezierHandle(50,150),new BezierHandle(150,50)];function getPos(c){var b=c.pageX-getOffSet(c.target).left,a=c.pageY-getOffSet(c.target).top;return{x:b,y:a};}function getOffSet(a){var b=curtop=0;if(a.offsetParent){do{b+=a.offsetLeft;curtop+=a.offsetTop;}while(a=a.offsetParent);return{left:b,top:curtop};}}var drag=false,draggingObj,oldX,oldY;function onPress(a){a.preventDefault();a.stopPropagation();var m=supportTouches?a.touches[0]:a;var b=getPos(m),l=b.x,j=b.y;for(var f=0;f<handles.length;f++){var h=handles[f],d=h.left,e=h.right,c=h.top,k=h.bottom;if(supportTouches){d-=20;e+=20;c-=20;k+=20;}if(l>=d&&l<=e&&j>=c&&j<=k){drag=true;draggingObj=h;oldX=a.pageX;oldY=a.pageY;var g=$("#presets option:selected");g.attr("selected","").parent().parent().find("option").last().attr("selected","selected");document.addEventListener("mouseup",onRelease,false);document.addEventListener("touchend",touchEnd,false);document.addEventListener("mousemove",onMove,false);document.addEventListener("touchmove",touchMove,false);document.body.style.cursor=canvas.style.cursor="move";}}}function onMove(a){var i=supportTouches?a.touches[0]:a;if(drag){var b=(i.pageX>=getOffSet(canvas).left&&i.pageX<=(getOffSet(canvas).left+canvas.width)&&i.pageY>=getOffSet(canvas).top&&i.pageY<=(getOffSet(canvas).top+canvas.height));var e=(i.pageY<=getOffSet(canvas).top),g=(i.pageY>=(getOffSet(canvas).top+canvas.height)),c=(i.pageX<=getOffSet(canvas).left),h=(i.pageX>=(getOffSet(canvas).left+canvas.width));var f=i.pageX,d=i.pageY;dx=f-oldX;dy=d-oldY;if(b){draggingObj.x+=dx;draggingObj.y+=dy;}else{if(e&&!c&&!h){draggingObj.x+=dx;draggingObj.y=0;}else{if(g&&!c&&!h){draggingObj.x+=dx;draggingObj.y=canvas.height;}else{if(c&&!e&&!g){draggingObj.x=0;draggingObj.y+=dy;}else{if(h&&!e&&!g){draggingObj.x=canvas.width;draggingObj.y+=dy;}}}}}if(draggingObj.x<0){draggingObj.x=0;}if(draggingObj.x>canvas.width){draggingObj.x=canvas.width;}if(draggingObj.y<0){draggingObj.y=0;}if(draggingObj.y>canvas.height){draggingObj.y=canvas.height;}updateDrawing();oldX=f;oldY=d;}}function touchMove(a){onMove(a);a.preventDefault();}function onRelease(a){drag=false;canvas.style.cursor="pointer";document.body.style.cursor="default";document.removeEventListener("mousemove",onMove,false);document.removeEventListener("touchmove",touchMove,false);document.removeEventListener("mouseup",onRelease,false);document.removeEventListener("touchend",touchEnd,false);}function touchEnd(a){onRelease(a);a.preventDefault();}canvas.addEventListener("mousedown",onPress,false);canvas.addEventListener("touchstart",function touchPress(a){onPress(a);a.preventDefault();},false);function updateDrawing(){ctx.clearRect(0,0,canvas.width,canvas.height);var e=handles[0],d=handles[1];ctx.save();ctx.strokeStyle="#4C84D3";ctx.lineWidth=3;ctx.beginPath();ctx.moveTo(0,canvas.height);ctx.bezierCurveTo(e.x,e.y,d.x,d.y,canvas.width,0);ctx.stroke();ctx.restore();ctx.strokeStyle="#f00";ctx.beginPath();ctx.moveTo(0,canvas.height);ctx.lineTo(e.x,e.y);ctx.moveTo(canvas.width,0);ctx.lineTo(d.x,d.y);ctx.stroke();for(var f=0;f<handles.length;f++){handles[f].draw();}var b=(e.x/canvas.width).toFixed(3),h=((canvas.height-e.y)/canvas.height).toFixed(3),a=(d.x/canvas.width).toFixed(3),g=((canvas.height-d.y)/canvas.height).toFixed(3),j="("+b+", "+h+", "+a+", "+g+")",c="cubic-bezier"+j;code.innerHTML="<p>-webkit-transition: all "+timeVal+"ms "+c+"; <br>&nbsp;&nbsp; -moz-transition: all "+timeVal+"ms "+c+"; <br>&nbsp;&nbsp;&nbsp;&nbsp; -o-transition: all "+timeVal+"ms "+c+"; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; transition: all "+timeVal+"ms "+c+"; </p><p> -webkit-transition-timing-function: "+c+"; <br>&nbsp;&nbsp; -moz-transition-timing-function: "+c+"; <br>&nbsp;&nbsp;&nbsp;&nbsp; -o-transition-timing-function: "+c+"; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; transition-timing-function: "+c+"; </p>";}function setTransitions(){var g=handles[0],f=handles[1],b=(g.x/canvas.width).toFixed(2),e=((canvas.height-g.y)/canvas.height).toFixed(2),a=(f.x/canvas.width).toFixed(2),c=((canvas.height-f.y)/canvas.height).toFixed(2),d="("+b+", "+e+", "+a+", "+c+")";timeVal=time.value;box.style.WebkitTransition=box.style.MozTransition=box.style.OTransition=box.style.transition="all "+timeVal+"ms cubic-bezier"+d;}setTransitions();updateDrawing();function presetChange(){var c=this.value.split(","),b=handles[0],a=handles[1];b.x=c[0]*canvas.width;b.y=canvas.height-(c[1]*canvas.height);a.x=c[2]*canvas.width;a.y=canvas.height-(c[3]*canvas.height);updateDrawing();}var $presets=$("#presets"),$time=$("#time"),$presetOpts=$("#presets option");$presets.change(presetChange);$(".testButton").click(function(){setTransitions();updateDrawing();$("#box").toggleClass($(this).val());});$time.change(function(){setTransitions();updateDrawing();});$time.keyup(function(){$(this).trigger("change");});$(document).keydown(function(b){if(b.keyCode===39&&b.target!==time){var c=$("#presets option:selected"),a=$presetOpts.index(c);if(a<$presetOpts.length-1){c.attr("selected","");$presetOpts.eq(a+1).attr("selected","selected");$presets.trigger("change");}}else{if(b.keyCode===37&&b.target!==time){var c=$("#presets option:selected"),a=$presetOpts.index(c);if(a>0){c.attr("selected","");$presetOpts.eq(a-1).attr("selected","selected");$presets.trigger("change");}}}});